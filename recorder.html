<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Camera Recording</title>
  </head>

  <body>
    <video id="video-preview" autoplay></video>
    <button id="start-recording">Start Recording</button>
    <button id="stop-recording">Stop Recording and Download</button>

    <script>
      const chunks = [];
      let mediaRecorder;
      let stream;

      const videoPreview = document.getElementById("video-preview");
      const startRecordingBtn = document.getElementById("start-recording");
      const stopRecordingBtn = document.getElementById("stop-recording");

      async function startRecording() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true,
          });

          videoPreview.srcObject = stream;

          const options = { mimeType: "video/webm;codecs=vp9" };
          mediaRecorder = new MediaRecorder(stream, options);

          mediaRecorder.addEventListener("dataavailable", handleDataAvailable);
          mediaRecorder.addEventListener("stop", handleStop);

          startRecordingBtn.disabled = true;
          stopRecordingBtn.disabled = false;

          mediaRecorder.start();
        } catch (error) {
          console.error("Error accessing camera and microphone:", error);
        }
      }

      function stopRecording() {
        mediaRecorder.stop();
        stream.getTracks().forEach((track) => track.stop());
      }

      function handleDataAvailable(event) {
        if (event.data.size > 0) {
          chunks.push(event.data);
        }
      }

      function handleStop() {
        const blob = new Blob(chunks, { type: "video/mp4" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        document.body.appendChild(a);
        a.style = "display: none";
        a.href = url;
        a.download = "recorded-video.mp4";
        a.click();
        window.URL.revokeObjectURL(url);

        chunks.length = 0;

        startRecordingBtn.disabled = false;
        stopRecordingBtn.disabled = true;
      }

      startRecordingBtn.addEventListener("click", startRecording);
      stopRecordingBtn.addEventListener("click", stopRecording);
    </script>
  </body>
</html>
